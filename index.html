<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenFront 1918 - Tactical Command</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --blue: #00d4ff; --red: #ff3131; --gold: #ffd700;
            --bg: #0a0a0a; --header-bg: #000; --panel: #141414; --border: #333;
        }
        
        /* CURSEUR PAR D√âFAUT (BLEU) */
        *, .leaflet-container {
            cursor: url("data:image/svg+xml;chatset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><circle cx='16' cy='16' r='6' fill='none' stroke='%2300d4ff' stroke-width='2'/><line x1='16' y1='0' x2='16' y2='32' stroke='%2300d4ff' stroke-width='1'/><line x1='0' y1='16' x2='32' y2='16' stroke='%2300d4ff' stroke-width='1'/></svg>") 16 16, crosshair !important;
        }

        /* CURSEUR SURVOL PAYS (ROUGE) */
        .target-hover {
            cursor: url("data:image/svg+xml;chatset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><circle cx='16' cy='16' r='6' fill='none' stroke='%23ff3131' stroke-width='2'/><line x1='16' y1='0' x2='16' y2='32' stroke='%23ff3131' stroke-width='1'/><line x1='0' y1='16' x2='32' y2='16' stroke='%23ff3131' stroke-width='1'/></svg>") 16 16, crosshair !important;
        }

        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Arial Black', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; color: white; }

        #info-header {
            width: 100%; height: 90px; background: var(--header-bg); border-bottom: 3px solid var(--blue);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 2000;
        }

        #timer { font-size: 2.2em; color: var(--red); font-weight: bold; margin-right: 20px; }

        .flag-frame { width: 70px; height: 45px; border: 1px solid var(--blue); background: #111; overflow: hidden; flex-shrink: 0; }
        #flag-img { width: 100%; height: 100%; object-fit: cover; display: none; }

        #main-view { display: flex; flex-grow: 1; width: 100%; position: relative; overflow: hidden; }
        
        #side-menu { 
            width: 0; background: var(--panel); overflow-y: auto; overflow-x: hidden;
            transition: 0.3s ease-in-out; border-right: 0px solid var(--blue); z-index: 1500;
        }
        #side-menu.active { width: 340px; border-right: 2px solid var(--blue); }
        
        .menu-content { width: 340px; padding: 20px; box-sizing: border-box; opacity: 0; transition: 0.3s; }
        #side-menu.active .menu-content { opacity: 1; }

        /* CARTES */
        .cards-container { display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; padding-bottom: 10px; }
        .strat-card { 
            min-width: 85px; height: 110px; background: #222; border: 1px solid var(--blue); 
            border-radius: 5px; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-size: 0.55em; text-align: center; padding: 5px; transition: 0.2s;
        }
        .strat-card:hover { background: var(--blue); color: black; transform: translateY(-5px); }

        /* RESSOURCES */
        .res-item { margin: 10px 0; font-size: 0.75em; }
        .res-bar { width: 100%; height: 6px; background: #222; margin-top: 4px; border-radius: 2px; }
        .res-fill { height: 100%; background: var(--blue); transition: 0.4s; }

        #toggle-btn { 
            position: absolute; left: 0; top: 50%; width: 25px; height: 60px; 
            background: var(--blue); border: none; z-index: 1600; display: none; transform: translateY(-50%);
        }

        #map { flex-grow: 1; background: #000 !important; z-index: 1; }
    </style>
</head>
<body>

<header id="info-header">
    <div id="timer">15</div>
    <div style="display: flex; align-items: center; gap: 20px; flex-grow: 1;">
        <div class="flag-frame"><img id="flag-img" src=""></div>
        <div id="country-name" style="font-size: 1.2em; text-transform: uppercase;">AWAITING SELECTION</div>
    </div>
    <div id="action-zone"></div>
</header>

<div id="main-view">
    <div id="side-menu">
        <div class="menu-content">
            <h3 style="color: var(--blue); border-bottom: 1px solid var(--blue); font-size: 0.9em; font-family: 'Arial Black';">STRATEGIC CARDS</h3>
            <div class="cards-container">
                <div class="strat-card"><div style="font-size:1.5em">üéñÔ∏è</div>REINFORCEMENTS</div>
                <div class="strat-card"><div style="font-size:1.5em">üöú</div>INDUSTRIAL</div>
                <div class="strat-card"><div style="font-size:1.5em">üì°</div>ESPIONAGE</div>
            </div>

            <h3 style="color: var(--gold); border-bottom: 1px solid var(--gold); font-size: 0.9em; margin-top: 20px; font-family: 'Arial Black';">RESOURCES</h3>
            <div class="res-item"><span>‚öôÔ∏è FER</span><div class="res-bar"><div id="fill-iron" class="res-fill" style="width: 70%;"></div></div></div>
            <div class="res-item"><span>üß± PIERRE</span><div class="res-bar"><div id="fill-stone" class="res-fill" style="width: 50%;"></div></div></div>
            <div class="res-item"><span>üõ¢Ô∏è PETROLE</span><div class="res-bar"><div id="fill-oil" class="res-fill" style="width: 30%; background:var(--red);"></div></div></div>
            <div class="res-item"><span>üåæ BLE</span><div class="res-bar"><div id="fill-wheat" class="res-fill" style="width: 80%;"></div></div></div>
            <div class="res-item"><span>ü™µ BOIS</span><div class="res-bar"><div id="fill-wood" class="res-fill" style="width: 60%;"></div></div></div>

            <div class="pop-section" style="margin-top:20px; background:#000; padding:10px; border:1px solid var(--border);">
                <div style="font-size: 0.6em; color: var(--blue); font-family: 'Arial Black';">POPULATION DISTRIBUTION</div>
                <div style="display:flex; height:12px; border:1px solid #444; margin:10px 0;">
                    <div id="bar-w" style="width: 70%; background:var(--blue);"></div>
                    <div id="bar-s" style="width: 30%; background:var(--red);"></div>
                </div>
                <input type="range" min="5" max="95" value="30" style="width: 100%;" oninput="syncStats(this.value)">
            </div>
        </div>
    </div>
    <button id="toggle-btn" onclick="toggleMenu()">></button>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { attributionControl: false, zoomControl: true }).setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png').addTo(map);

    let hqLocked = false, selectedLayer = null, timeLeft = 15;

    function syncStats(val) {
        const workers = 100 - val;
        document.getElementById('bar-s').style.width = val + "%";
        document.getElementById('bar-w').style.width = workers + "%";
        // Met √† jour visuellement les barres
        document.getElementById('fill-iron').style.width = (workers * 0.8) + "%";
        document.getElementById('fill-wheat').style.width = (workers * 0.9) + "%";
    }

    const timerInterval = setInterval(() => {
        if (hqLocked) return;
        timeLeft--;
        document.getElementById('timer').innerText = timeLeft;
        if (timeLeft <= 0) { clearInterval(timerInterval); location.reload(); }
    }, 1000);

    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(r => r.json())
    .then(data => {
        L.geoJson(data, {
            style: { fillColor: '#222', fillOpacity: 0.7, color: '#444', weight: 1 },
            onEachFeature: (feature, layer) => {
                // SURVOL : COULEUR ET CURSEUR
                layer.on('mouseover', function(e) {
                    if (!hqLocked) {
                        this.setStyle({ fillColor: '#444', fillOpacity: 0.9 });
                        document.getElementById('map').classList.add('target-hover');
                    }
                });
                layer.on('mouseout', function(e) {
                    if (!hqLocked && this !== selectedLayer) {
                        this.setStyle({ fillColor: '#222', fillOpacity: 0.7 });
                    }
                    document.getElementById('map').classList.remove('target-hover');
                });

                layer.on('click', () => {
                    if(hqLocked) return;
                    if(selectedLayer) selectedLayer.setStyle({fillColor: '#222'});
                    selectedLayer = layer;
                    layer.setStyle({fillColor: '#555', color: var(--blue)});
                    
                    const iso = (feature.properties.ISO_A2 || feature.properties.iso_a2 || "").toLowerCase();
                    document.getElementById('country-name').innerText = feature.properties.ADMIN || feature.properties.name;
                    const img = document.getElementById('flag-img');
                    img.src = `https://flagcdn.com/w160/${iso}.png`;
                    img.style.display = "block";
                    document.getElementById('action-zone').innerHTML = `<button onclick="lockHQ()" style="background:var(--blue); border:none; padding:10px 20px; font-weight:bold; color:black; font-family:'Arial Black';">ESTABLISH HQ</button>`;
                });
            }
        }).addTo(map);
    });

    window.lockHQ = function() {
        hqLocked = true;
        document.getElementById('timer').style.display = 'none';
        selectedLayer.setStyle({ fillColor: '#00d4ff', color: '#ffd700', weight: 2, fillOpacity: 0.8 });
        document.getElementById('side-menu').classList.add('active');
        document.getElementById('toggle-btn').style.display = 'block';
        document.getElementById('toggle-btn').style.left = "340px";
        document.getElementById('action-zone').innerHTML = `<b style="color:var(--blue); font-family:'Arial Black';">HQ SECURED</b>`;
        map.fitBounds(selectedLayer.getBounds());
    };

    window.toggleMenu = function() {
        const menu = document.getElementById('side-menu');
        const btn = document.getElementById('toggle-btn');
        const isOpen = menu.classList.toggle('active');
        btn.innerText = isOpen ? "<" : ">";
        btn.style.left = isOpen ? "340px" : "0";
    };
</script>
</body>
</html>
