<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenFront 1918 - Strategic Command</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --blue: #00d4ff; --red: #ff3131; --gold: #ffd700;
            --bg: #111; --header-bg: #000; --text: #fff; --panel: #1a1a1a; --border: #333;
        }
        
        * {
            cursor: url("data:image/svg+xml;chatset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><circle cx='16' cy='16' r='6' fill='none' stroke='%2300d4ff' stroke-width='2'/><line x1='16' y1='0' x2='16' y2='32' stroke='%2300d4ff' stroke-width='1'/><line x1='0' y1='16' x2='32' y2='16' stroke='%2300d4ff' stroke-width='1'/></svg>") 16 16, crosshair !important;
        }

        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Arial Black', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        #info-header {
            width: 100%; height: 100px; background: var(--header-bg); color: var(--text);
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 4px solid var(--blue); box-sizing: border-box; padding: 0 20px; z-index: 1001;
        }

        .flag-frame { width: 80px; height: 50px; border: 2px solid var(--blue); background: #222; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        #flag-img { width: 100%; height: 100%; object-fit: cover; display: none; z-index: 2; }

        #main-view { display: flex; flex-grow: 1; width: 100%; position: relative; overflow: hidden; }
        
        /* MENU LAT√âRAL STYLE MILITAIRE */
        #side-menu { 
            width: 0; background: var(--panel); overflow-y: auto; overflow-x: hidden; transition: width 0.4s ease; 
            color: var(--text); display: flex; flex-direction: column; border-right: 0px solid var(--blue); z-index: 1000;
        }
        #side-menu.active { width: 320px; border-right: 2px solid var(--blue); }
        
        .menu-content { width: 280px; padding: 20px; box-sizing: border-box; opacity: 0; transition: 0.3s; }
        #side-menu.active .menu-content { opacity: 1; }

        /* RESSOURCES */
        .res-item { display: flex; align-items: center; justify-content: space-between; margin: 10px 0; font-size: 0.8em; border-left: 3px solid var(--blue); padding-left: 10px; }
        .res-icon { font-size: 1.2em; margin-right: 10px; }
        .res-bar { flex-grow: 1; height: 5px; background: #333; margin: 0 10px; position: relative; }
        .res-fill { height: 100%; background: var(--blue); width: 60%; }

        /* GRAPHIQUE */
        .chart-container { width: 100%; margin-top: 25px; background: #000; padding: 10px; border: 1px solid var(--border); box-sizing: border-box; }
        
        #toggle-btn { position: absolute; left: 0; top: 50%; transform: translateY(-50%); background: var(--blue); border: none; width: 25px; height: 50px; display: none; z-index: 2000; font-weight: bold; }

        #map { flex-grow: 1; background: #000 !important; }
        #game-over { position: fixed; inset: 0; background: rgba(50, 0, 0, 0.95); color: white; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
    </style>
</head>
<body>

<div id="game-over">
    <h1>STRATEGIC COLLAPSE</h1>
    <button onclick="location.reload()" style="padding: 10px 20px;">RESTART SYSTEM</button>
</div>

<header id="info-header">
    <div id="timer" style="font-size: 2.5em; color: var(--red);">15</div>
    <div style="display: flex; align-items: center; flex-grow: 1; margin-left: 30px;">
        <div class="flag-frame"><img id="flag-img" src=""></div>
        <div id="country-name" style="font-size: 1.4em; margin-left: 15px; text-transform: uppercase;">AWAITING COMMAND</div>
    </div>
    <div id="action-zone"></div>
</header>

<div id="main-view">
    <div id="side-menu">
        <div class="menu-content">
            <h3 style="color: var(--blue); border-bottom: 1px solid var(--blue); margin-bottom: 5px;">STRATEGIC ASSETS</h3>
            <div id="hq-name" style="color: var(--gold); margin-bottom: 20px;">SECTOR NOT SECURED</div>

            <div class="res-item"><span>‚öôÔ∏è Iron</span><div class="res-bar"><div class="res-fill" style="width: 85%;"></div></div><span>850</span></div>
            <div class="res-item"><span>üß± Stone</span><div class="res-bar"><div class="res-fill" style="width: 40%;"></div></div><span>400</span></div>
            <div class="res-item"><span>üõ¢Ô∏è Oil</span><div class="res-bar"><div class="res-fill" style="width: 25%; background: var(--red);"></div></div><span>120</span></div>
            <div class="res-item"><span>üåæ Wheat</span><div class="res-bar"><div class="res-fill" style="width: 65%;"></div></div><span>620</span></div>
            <div class="res-item"><span>ü™µ Wood</span><div class="res-bar"><div class="res-fill" style="width: 55%;"></div></div><span>510</span></div>

            <div class="chart-container">
                <span style="font-size: 0.7em; color: var(--blue);">WAR PRODUCTION OUTPUT</span>
                <canvas id="warChart"></canvas>
            </div>
        </div>
    </div>
    <button id="toggle-btn" onclick="toggleMenu()">></button>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { attributionControl: false, zoomControl: true, minZoom: 2 }).setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', { noWrap: true }).addTo(map);

    let hqLocked = false, selectedLayer = null, timeLeft = 15;
    const flagImg = document.getElementById('flag-img');
    const countryName = document.getElementById('country-name');

    // Chrono
    const countdown = setInterval(() => {
        if (hqLocked) return;
        timeLeft--;
        document.getElementById('timer').innerText = timeLeft;
        if (timeLeft <= 0) { clearInterval(countdown); document.getElementById('game-over').style.display = 'flex'; }
    }, 1000);

    // Initialisation du Graphique
    const ctx = document.getElementById('warChart').getContext('2d');
    const warChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['1914', '1915', '1916', '1917', '1918'],
            datasets: [{
                label: 'Industrial Power',
                data: [12, 19, 35, 50, 80],
                borderColor: '#00d4ff',
                backgroundColor: 'rgba(0, 212, 255, 0.1)',
                borderWidth: 2,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            scales: { y: { display: false }, x: { ticks: { color: '#555', font: { size: 10 } } } },
            plugins: { legend: { display: false } }
        }
    });

    function getFlag(iso) {
        if (!iso || iso === "-99") return;
        const code = iso.toLowerCase().substring(0, 2);
        flagImg.src = `https://flagcdn.com/w160/${code}.png`;
        flagImg.onload = () => { flagImg.style.display = "block"; };
    }

    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(r => r.json())
    .then(data => {
        L.geoJson(data, {
            style: { fillColor: '#333', fillOpacity: 0.6, color: '#555', weight: 1 },
            onEachFeature: (feature, layer) => {
                layer.on('click', (e) => {
                    const props = feature.properties;
                    const name = props.ADMIN || props.name;
                    countryName.innerText = name;
                    getFlag(props.ISO_A2 || props.iso_a2 || "");

                    if(!hqLocked) {
                        if(selectedLayer) selectedLayer.setStyle({fillColor:'#333'});
                        selectedLayer = layer;
                        layer.setStyle({fillColor:'#555', weight: 2});
                        document.getElementById('action-zone').innerHTML = `<button onclick="lockHQ()" style="background:var(--blue); border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">DEPLOY HQ</button>`;
                    }
                });
            }
        }).addTo(map);
    });

    window.lockHQ = function() {
        hqLocked = true;
        selectedLayer.setStyle({ fillColor: '#00d4ff', color: '#ffd700', weight: 3, fillOpacity: 1 });
        document.getElementById('side-menu').classList.add('active');
        document.getElementById('toggle-btn').style.display = 'block';
        document.getElementById('toggle-btn').style.left = "320px";
        document.getElementById('hq-name').innerText = countryName.innerText;
        document.getElementById('action-zone').innerHTML = `<b style="color:var(--blue)">COMM LINK OPEN</b>`;
        map.fitBounds(selectedLayer.getBounds());
    };

    window.toggleMenu = function() {
        const menu = document.getElementById('side-menu');
        const btn = document.getElementById('toggle-btn');
        const isOpen = menu.classList.toggle('active');
        btn.innerText = isOpen ? "<" : ">";
        btn.style.left = isOpen ? "320px" : "0";
    };
</script>
</body>
</html>
