\<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>OpenFront 1918 - Drapeaux & Ressources</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --blue: #00d4ff; --red: #ff3131; --gold: #ffd700; --green: #2ecc71;
            --bg: #111; --header-bg: #000; --text: #fff; --panel: #1a1a1a; --border: #333;
            --iron: #bdc3c7; --stone: #7f8c8d; --oil: #2c3e50; --wood: #27ae60; --wheat: #f1c40f;
        }
        * { cursor: crosshair !important; }
        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        #info-header {
            width: 100%; height: 120px;
            background: var(--header-bg); color: var(--text);
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 4px solid var(--blue); box-sizing: border-box; padding: 0 30px; z-index: 1001;
        }

        .flag-frame { 
            width: 110px; height: 80px; border: 2px solid var(--blue); 
            background: #222; display: flex; align-items: center; justify-content: center; 
            border-radius: 12px; box-shadow: inset 0 0 15px rgba(0, 212, 255, 0.2); font-size: 3.5em;
        }

        #main-view { display: flex; flex-grow: 1; width: 100%; position: relative; overflow: hidden; }
        
        #side-menu { 
            width: 0; background: var(--panel); overflow-y: auto; transition: width 0.4s ease; 
            color: var(--text); display: flex; flex-direction: column; z-index: 1000;
        }
        #side-menu.active { width: 320px; border-right: 2px solid var(--blue); }
        .menu-content { width: 300px; padding: 20px; box-sizing: border-box; opacity: 0; transition: 0.3s; }
        #side-menu.active .menu-content { opacity: 1; }

        .money-box { background: #000; padding: 10px; border: 1px dashed var(--gold); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .res-item { display: flex; align-items: center; justify-content: space-between; margin: 8px 0; font-size: 0.85em; border-left: 3px solid var(--blue); padding-left: 10px; }
        .res-bar { flex-grow: 1; height: 6px; background: #333; margin: 0 10px; border-radius: 3px; overflow: hidden; }
        .res-fill { height: 100%; transition: width 0.5s; }

        .pop-section { margin-top: 20px; padding: 15px; background: #000; border: 1px solid var(--border); border-radius: 8px; }
        .ratio-container { width: 100%; height: 25px; display: flex; margin: 10px 0; border-radius: 4px; overflow: hidden; border: 1px solid #444; }
        .ratio-workers { background: var(--blue); height: 100%; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: bold; color: #000; }
        .ratio-soldiers { background: var(--red); height: 100%; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: bold; color: #fff; }
        
        .prio-slider { -webkit-appearance: none; width: 100%; height: 4px; background: #333; outline: none; border-radius: 2px; margin: 8px 0; }
        .prio-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; border-radius: 50%; background: var(--blue); border: 2px solid #000; cursor: pointer; }

        #toggle-btn { position: absolute; left: 0; top: 50%; transform: translateY(-50%); background: var(--blue); border: none; width: 25px; height: 50px; display: none; z-index: 2000; font-weight: bold; border-radius: 0 5px 5px 0; }
        #map { flex-grow: 1; background: #0b0b0b !important; }
        #game-over { position: fixed; inset: 0; background: rgba(20, 0, 0, 0.95); color: white; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
    </style>
</head>
<body>

<div id="game-over">
    <h1 style="font-size: 3em;">MISSION INTERROMPUE</h1>
    <button style="padding:12px 24px; background:var(--red); border:none; color:white; font-weight:bold; cursor:pointer;" onclick="location.reload()">R√âESSAYER</button>
</div>

<header id="info-header">
    <div id="timer" style="font-size: 2.5em; color: var(--red); font-weight: bold; width: 60px;">15</div>
    <div style="display: flex; align-items: center; flex-grow: 1; margin-left: 30px;">
        <div class="flag-frame"><span id="flag-emoji">üåê</span></div>
        <div id="country-name" style="font-size: 1.8em; margin-left: 20px; font-weight: bold; letter-spacing: 1px;">S√âLECTIONNEZ UNE ZONE</div>
    </div>
    <div id="action-zone"></div>
</header>

<div id="main-view">
    <div id="side-menu">
        <div class="menu-content">
            <h3 style="color: var(--blue); border-bottom: 2px solid var(--blue); padding-bottom: 5px;">GESTION DU TERRITOIRE</h3>
            <div id="hq-name" style="color: var(--gold); margin-bottom: 15px; font-weight: bold;">---</div>

            <div class="money-box">
                <span style="font-size: 1.5em;">üí∞</span>
                <div>
                    <div style="font-size: 0.6em; color: var(--gold);">BUDGET NATIONAL</div>
                    <div id="money-val" style="font-size: 1.1em; font-family: monospace;">1,240,500 $</div>
                </div>
            </div>

            <div class="res-item"><span>Fer</span><div class="res-bar"><div id="stk-fer" class="res-fill" style="width: 70%; background: var(--iron);"></div></div></div>
            <div class="res-item"><span>P√©trole</span><div class="res-bar"><div id="stk-oil" class="res-fill" style="width: 40%; background: var(--oil);"></div></div></div>
            <div class="res-item"><span>Pierre</span><div class="res-bar"><div id="stk-stone" class="res-fill" style="width: 50%; background: var(--stone);"></div></div></div>
            <div class="res-item"><span>Bois</span><div class="res-bar"><div id="stk-wood" class="res-fill" style="width: 30%; background: var(--wood);"></div></div></div>
            <div class="res-item"><span>Bl√©</span><div class="res-bar"><div id="stk-wheat" class="res-fill" style="width: 80%; background: var(--wheat);"></div></div></div>

            <div class="pop-section">
                <div class="ratio-container">
                    <div id="workers-bar" class="ratio-workers">TRAVAIL</div>
                    <div id="soldiers-bar" class="ratio-soldiers">ARM√âE</div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.7em; margin-bottom: 10px;">
                    <span id="pop-total">Pop: 42.5M</span>
                    <span id="mobilization-text" style="color: var(--red);">Mobilisation: 30%</span>
                </div>
                <input type="range" min="0" max="100" value="30" style="width:100%" oninput="updateMainRatio(this.value)">

                <div style="margin-top:15px; font-size: 0.75em; color: var(--gold);">R√âPARTITION OUVRI√àRE</div>
                
                <div style="font-size:0.7em; margin-top:10px;">‚õèÔ∏è Fer: <span id="txt-fer">0%</span></div>
                <input type="range" class="prio-slider" min="0" max="100" value="20" oninput="updateWorkerDistribution()">
                
                <div style="font-size:0.7em;">üõ¢Ô∏è P√©trole: <span id="txt-oil">0%</span></div>
                <input type="range" class="prio-slider" min="0" max="100" value="10" oninput="updateWorkerDistribution()">

                <div style="font-size:0.7em;">üß± Pierre: <span id="txt-stone">0%</span></div>
                <input type="range" class="prio-slider" min="0" max="100" value="20" oninput="updateWorkerDistribution()">

                <div style="font-size:0.7em;">üå≤ For√™t: <span id="txt-wood">0%</span></div>
                <input type="range" class="prio-slider" min="0" max="100" value="20" oninput="updateWorkerDistribution()">

                <div style="font-size:0.7em;">üåæ Bl√©: <span id="txt-wheat">0%</span></div>
                <input type="range" class="prio-slider" min="0" max="100" value="30" oninput="updateWorkerDistribution()">
            </div>
        </div>
    </div>
    <button id="toggle-btn" onclick="toggleMenu()">></button>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { attributionControl: false, zoomControl: false, minZoom: 2 }).setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png').addTo(map);

    let hqLocked = false, selectedLayer = null, timeLeft = 15;
    let currentWorkerPct = 70;
    const totalPopulationMillions = 42.5;

    const flagMap = { "Afghanistan": "üá¶üá´", "Albania": "üá¶üá±", "Algeria": "üá©üáø", "Argentina": "üá¶üá∑", "Australia": "üá¶üá∫", "Austria": "üá¶üáπ", "Belgium": "üáßüá™", "Brazil": "üáßüá∑", "Bulgaria": "üáßüá¨", "Canada": "üá®üá¶", "Chile": "üá®üá±", "China": "üá®üá≥", "Colombia": "üá®üá¥", "Cuba": "üá®üá∫", "Denmark": "üá©üá∞", "Egypt": "üá™üá¨", "Finland": "üá´üáÆ", "France": "üá´üá∑", "Germany": "üá©üá™", "Greece": "üá¨üá∑", "India": "üáÆüá≥", "Iran": "üáÆüá∑", "Iraq": "üáÆüá∂", "Ireland": "üáÆüá™", "Italy": "üáÆüáπ", "Japan": "üáØüáµ", "Mexico": "üá≤üáΩ", "Morocco": "üá≤üá¶", "Netherlands": "üá≥üá±", "Norway": "üá≥üá¥", "Ottoman Empire": "üáπüá∑", "Poland": "üáµüá±", "Portugal": "üáµüáπ", "Romania": "üá∑üá¥", "Russia": "üá∑üá∫", "Spain": "üá™üá∏", "Sweden": "üá∏üá™", "Switzerland": "üá®üá≠", "United Kingdom": "üá¨üáß", "United States of America": "üá∫üá∏" };

    function getFlag(iso, name) {
        if (flagMap[name]) return flagMap[name];
        if (iso && iso !== "-99") return String.fromCodePoint(...[...iso.toUpperCase()].map(c => c.charCodeAt(0) + 127397));
        return "üåê";
    }

    const timerInt = setInterval(() => {
        if (hqLocked) return;
        timeLeft--;
        document.getElementById('timer').innerText = timeLeft;
        if (timeLeft <= 0) { clearInterval(timerInt); document.getElementById('game-over').style.display = 'flex'; }
    }, 1000);

    window.updateMainRatio = function(val) {
        document.getElementById('soldiers-bar').style.width = val + "%";
        document.getElementById('workers-bar').style.width = (100 - val) + "%";
        document.getElementById('mobilization-text').innerText = "Mobilisation: " + val + "%";
        currentWorkerPct = 100 - val;
        updateWorkerDistribution();
    };

    window.updateWorkerDistribution = function() {
        const sliders = document.querySelectorAll('.prio-slider');
        const weights = Array.from(sliders).map(s => parseInt(s.value));
        const totalW = weights.reduce((a, b) => a + b, 0) || 1;
        const availPop = totalPopulationMillions * (currentWorkerPct / 100);
        const ids = ['fer', 'oil', 'stone', 'wood', 'wheat'];
        weights.forEach((w, i) => {
            const pct = (w / totalW);
            document.getElementById(`txt-${ids[i]}`).innerText = Math.round(pct * 100) + "% (" + (availPop * pct).toFixed(1) + "M)";
        });
    };

    window.lockHQ = function() {
        if (!selectedLayer) return;
        hqLocked = true;
        document.getElementById('timer').style.display = 'none'; // Suppression horloge
        selectedLayer.setStyle({ fillColor: '#00d4ff', color: '#ffd700', weight: 3 });
        document.getElementById('side-menu').classList.add('active');
        document.getElementById('toggle-btn').style.display = 'block';
        document.getElementById('toggle-btn').style.left = "320px";
        document.getElementById('hq-name').innerText = "QG ACTIV√â : " + document.getElementById('country-name').innerText;
        document.getElementById('action-zone').innerHTML = `<span style="color:var(--green)">QG OP√âRATIONNEL</span>`;
        map.fitBounds(selectedLayer.getBounds());
    };

    window.toggleMenu = function() {
        const isOpen = document.getElementById('side-menu').classList.toggle('active');
        document.getElementById('toggle-btn').innerText = isOpen ? "<" : ">";
        document.getElementById('toggle-btn').style.left = isOpen ? "320px" : "0";
    };

    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(r => r.json())
    .then(data => {
        L.geoJson(data, {
            style: { fillColor: '#222', fillOpacity: 0.7, color: '#444', weight: 1 },
            onEachFeature: (f, l) => {
                l.on('mouseover', function() {
                    if(hqLocked) return;
                    const n = f.properties.ADMIN || f.properties.name;
                    document.getElementById('country-name').innerText = n.toUpperCase();
                    document.getElementById('flag-emoji').innerText = getFlag(f.properties.ISO_A2, n);
                });
                l.on('click', function() {
                    if(hqLocked) return;
                    if(selectedLayer) selectedLayer.setStyle({ fillColor: '#222', color: '#444' });
                    selectedLayer = this;
                    this.setStyle({ fillColor: '#333', color: '#00d4ff' });
                    document.getElementById('action-zone').innerHTML = `<button onclick="lockHQ()" style="background:var(--blue); border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">√âTABLIR QG</button>`;
                });
            }
        }).addTo(map);
    });

    updateMainRatio(30);
</script>
</body>
</html>
