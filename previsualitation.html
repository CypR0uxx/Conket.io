<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenFront 1918 - Global Flags (Emoji)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --blue: #00d4ff; --red: #ff3131; --gold: #ffd700; --green: #2ecc71;
            --bg: #111; --header-bg: #000; --text: #fff; --panel: #1a1a1a; --border: #333;
        }
        
        * {
            cursor: url("data:image/svg+xml;chatset=UTF-8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><circle cx='16' cy='16' r='6' fill='none' stroke='%2300d4ff' stroke-width='2'/><line x1='16' y1='0' x2='16' y2='32' stroke='%2300d4ff' stroke-width='1'/><line x1='0' y1='16' x2='32' y2='16' stroke='%2300d4ff' stroke-width='1'/></svg>") 16 16, crosshair !important;
        }

        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Arial Black', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        #info-header {
            width: 100%; height: 120px;
            background: var(--header-bg); color: var(--text);
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 4px solid var(--blue); box-sizing: border-box; padding: 0 30px; z-index: 1001;
        }

        /* STYLE POUR LES EMOJIS */
        .flag-frame { 
            width: 100px; height: 60px; 
            border: 2px solid var(--blue); 
            background: #222; 
            display: flex; align-items: center; justify-content: center; 
            position: relative; overflow: hidden;
            font-size: 3.5em; /* Grande taille pour l'emoji */
            padding-bottom: 5px;
        }
        
        /* Span texte pour l'emoji */
        #flag-emoji { 
            line-height: 1;
            cursor: default;
        }

        #main-view { display: flex; flex-grow: 1; width: 100%; position: relative; overflow: hidden; }
        
        #side-menu { 
            width: 0; background: var(--panel); overflow-y: auto; transition: width 0.4s ease; 
            color: var(--text); display: flex; flex-direction: column; z-index: 1000;
        }
        #side-menu.active { width: 320px; border-right: 2px solid var(--blue); }
        
        .menu-content { width: 280px; padding: 20px; box-sizing: border-box; opacity: 0; transition: 0.3s; }
        #side-menu.active .menu-content { opacity: 1; }

        /* ECONOMY SECTION */
        .money-box { background: #000; padding: 10px; border: 1px dashed var(--gold); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* RESOURCES */
        .res-item { display: flex; align-items: center; justify-content: space-between; margin: 8px 0; font-size: 0.8em; border-left: 3px solid var(--blue); padding-left: 10px; }
        .res-bar { flex-grow: 1; height: 5px; background: #333; margin: 0 10px; }
        .res-fill { height: 100%; background: var(--blue); }

        /* POPULATION RATIO */
        .pop-section { margin-top: 30px; padding: 15px; background: #000; border: 1px solid var(--border); }
        .ratio-container { width: 100%; height: 25px; display: flex; margin: 10px 0; border: 1px solid #444; }
        .ratio-workers { background: var(--blue); height: 100%; transition: 0.5s; display: flex; align-items: center; justify-content: center; font-size: 0.6em; }
        .ratio-soldiers { background: var(--red); height: 100%; transition: 0.5s; display: flex; align-items: center; justify-content: center; font-size: 0.6em; }
        
        #toggle-btn { position: absolute; left: 0; top: 50%; transform: translateY(-50%); background: var(--blue); border: none; width: 25px; height: 50px; display: none; z-index: 2000; font-weight: bold; }

        #map { flex-grow: 1; background: #000 !important; }
        #game-over { position: fixed; inset: 0; background: rgba(50, 0, 0, 0.95); color: white; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
    </style>
</head>
<body>

<div id="game-over">
    <h1>CRITICAL FAILURE</h1>
    <button onclick="location.reload()">REBOOT</button>
</div>

<header id="info-header">
    <div id="timer" style="font-size: 2.5em; color: var(--red);">15</div>
    <div style="display: flex; align-items: center; flex-grow: 1; margin-left: 30px;">
        <!-- REPASSAGE AU SPAN POUR LES EMOJIS -->
        <div class="flag-frame"><span id="flag-emoji">üè¥</span></div>
        <div id="country-name" style="font-size: 1.6em; margin-left: 20px; text-transform: uppercase;">SCANNING...</div>
    </div>
    <div id="action-zone"></div>
</header>

<div id="main-view">
    <div id="side-menu">
        <div class="menu-content">
            <h3 style="color: var(--blue); border-bottom: 1px solid var(--blue); margin-bottom: 10px;">NATIONAL AUDIT</h3>
            <div id="hq-name" style="color: var(--gold); margin-bottom: 15px; font-size: 0.9em;">---</div>

            <div class="money-box">
                <span style="font-size: 1.5em;">üí∞</span>
                <div style="text-align: left;">
                    <div style="font-size: 0.6em; color: var(--gold);">TREASURY RESERVE</div>
                    <div id="money-val" style="font-size: 1.2em;">1,240,500 $</div>
                </div>
            </div>

            <div class="res-item"><span>‚öôÔ∏è Iron</span><div class="res-bar"><div class="res-fill" style="width: 70%;"></div></div><span>700</span></div>
            <div class="res-item"><span>üß± Stone</span><div class="res-bar"><div class="res-fill" style="width: 45%;"></div></div><span>450</span></div>
            <div class="res-item"><span>üõ¢Ô∏è Oil</span><div class="res-bar"><div class="res-fill" style="width: 20%; background:var(--red);"></div></div><span>90</span></div>
            <div class="res-item"><span>üåæ Wheat</span><div class="res-bar"><div class="res-fill" style="width: 80%;"></div></div><span>800</span></div>
            <div class="res-item"><span>ü™µ Wood</span><div class="res-bar"><div class="res-fill" style="width: 50%;"></div></div><span>500</span></div>

            <div class="pop-section">
                <span style="font-size: 0.7em; color: var(--blue);">POPULATION DISTRIBUTION</span>
                <div class="ratio-container">
                    <div id="workers-bar" class="ratio-workers" style="width: 70%;">WORKERS</div>
                    <div id="soldiers-bar" class="ratio-soldiers" style="width: 30%;">SOLDIERS</div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.6em; margin-top: 5px;">
                    <span id="pop-total">Total: 42.5M</span>
                    <span style="color: var(--red);">Mobilization: 30%</span>
                </div>
                <input type="range" min="10" max="90" value="30" style="width:100%; margin-top:15px; cursor: pointer;" oninput="updateRatio(this.value)">
            </div>
        </div>
    </div>
    <button id="toggle-btn" onclick="toggleMenu()">></button>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { attributionControl: false, zoomControl: true, minZoom: 2 }).setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', { noWrap: true }).addTo(map);

    let hqLocked = false, selectedLayer = null, timeLeft = 15;
    const flagEmoji = document.getElementById('flag-emoji');
    const countryName = document.getElementById('country-name');

    // Mise √† jour manuelle du ratio pour la d√©mo
    window.updateRatio = function(val) {
        document.getElementById('soldiers-bar').style.width = val + "%";
        document.getElementById('workers-bar').style.width = (100 - val) + "%";
        document.querySelector('.pop-section span[style*="color: var(--red)"]').innerText = "Mobilization: " + val + "%";
    };

    const countdown = setInterval(() => {
        if (hqLocked) return;
        timeLeft--;
        document.getElementById('timer').innerText = timeLeft;
        if (timeLeft <= 0) { clearInterval(countdown); document.getElementById('game-over').style.display = 'flex'; }
    }, 1000);

    // TRADUCTIONS FRAN√áAISES
    const translations = {
        "Afghanistan": "Afghanistan", "South Africa": "Afrique du Sud", "Albania": "Albanie", "Germany": "Allemagne",
        "Algeria": "Alg√©rie", "Andorra": "Andorre", "Angola": "Angola", "Anguilla": "Anguilla", "Antigua and Barbuda": "Antigua-et-Barbuda",
        "Saudi Arabia": "Arabie Saoudite", "Argentina": "Argentine", "Armenia": "Arm√©nie", "Australia": "Australie",
        "Austria": "Autriche", "Azerbaijan": "Azerba√Ødjan", "Bahamas": "Bahamas", "Bahrain": "Bahre√Øn",
        "Bangladesh": "Bangladesh", "Barbados": "Barbade", "Belgium": "Belgique", "Belize": "Belize", "Benin": "B√©nin",
        "Bhutan": "Bhoutan", "Belarus": "Bi√©lorussie", "Myanmar": "Birmanie", "Bolivia": "Bolivie",
        "Bosnia and Herzegovina": "Bosnie-Herz√©govine", "Botswana": "Botswana", "Brazil": "Br√©sil", "Brunei": "Brunei",
        "Bulgaria": "Bulgarie", "Burkina Faso": "Burkina Faso", "Burundi": "Burundi", "Cambodia": "Cambodge",
        "Cameroon": "Cameroun", "Canada": "Canada", "Cape Verde": "Cap-Vert", "Central African Republic": "Centrafrique",
        "Chile": "Chili", "China": "Chine", "Cyprus": "Chypre", "Colombia": "Colombie", "Comoros": "Comores",
        "Republic of Congo": "Congo", "Democratic Republic of the Congo": "Congo (RDC)", "South Korea": "Cor√©e du Sud",
        "North Korea": "Cor√©e du Nord", "Costa Rica": "Costa Rica", "Ivory Coast": "C√¥te d'Ivoire", "Croatia": "Croatie",
        "Cuba": "Cuba", "Denmark": "Danemark", "Djibouti": "Djibouti", "Dominica": "Dominique", "Egypt": "√âgypte",
        "United Arab Emirates": "√âmirats arabes unis", "Ecuador": "√âquateur", "Eritrea": "√ârythr√©e", "Spain": "Espagne",
        "Estonia": "Estonie", "Swaziland": "Eswatini", "United States of America": "√âtats-Unis", "Ethiopia": "√âthiopie",
        "Finland": "Finlande", "Fiji": "Fidji", "France": "France", "Gabon": "Gabon", "Gambia": "Gambie",
        "Georgia": "G√©orgie", "Ghana": "Ghana", "Greece": "Gr√®ce", "Grenada": "Grenade", "Guatemala": "Guatemala",
        "Guinea": "Guin√©e", "Guinea-Bissau": "Guin√©e-Bissau", "Equatorial Guinea": "Guin√©e √©quatoriale", "Guyana": "Guyana",
        "Haiti": "Ha√Øti", "Honduras": "Honduras", "Hungary": "Hongrie", "India": "Inde", "Indonesia": "Indon√©sie",
        "Iraq": "Irak", "Iran": "Iran", "Ireland": "Irlande", "Iceland": "Islande", "Israel": "Isra√´l", "Italy": "Italie",
        "Jamaica": "Jama√Øque", "Japan": "Japon", "Jordan": "Jordanie", "Kazakhstan": "Kazakhstan", "Kenya": "Kenya",
        "Kyrgyzstan": "Kirghizistan", "Kiribati": "Kiribati", "Kuwait": "Kowe√Øt", "Laos": "Laos", "Lesotho": "Lesotho",
        "Latvia": "Lettonie", "Lebanon": "Liban", "Liberia": "Liberia", "Libya": "Libye", "Liechtenstein": "Liechtenstein",
        "Lithuania": "Lituanie", "Luxembourg": "Luxembourg", "Macedonia": "Mac√©doine du Nord", "Madagascar": "Madagascar",
        "Malaysia": "Malaisie", "Malawi": "Malawi", "Maldives": "Maldives", "Mali": "Mali", "Malta": "Malte",
        "Morocco": "Maroc", "Marshall Islands": "Marshall", "Mauritius": "Maurice", "Mauritania": "Mauritanie",
        "Mexico": "Mexique", "Micronesia": "Micron√©sie", "Moldova": "Moldavie", "Monaco": "Monaco", "Mongolia": "Mongolie",
        "Montenegro": "Mont√©n√©gro", "Mozambique": "Mozambique", "Namibia": "Namibie", "Nauru": "Nauru", "Nepal": "N√©pal",
        "Nicaragua": "Nicaragua", "Niger": "Niger", "Nigeria": "Nig√©ria", "Norway": "Norv√®ge", "New Zealand": "Nouvelle-Z√©lande",
        "Oman": "Oman", "Uganda": "Ouganda", "Uzbekistan": "Ouzb√©kistan", "Pakistan": "Pakistan", "Palau": "Palaos",
        "Palestine": "Palestine", "Panama": "Panama", "Papua New Guinea": "Papouasie-Nouvelle-Guin√©e", "Paraguay": "Paraguay",
        "Netherlands": "Pays-Bas", "Peru": "P√©rou", "Philippines": "Philippines", "Poland": "Pologne", "Portugal": "Portugal",
        "Qatar": "Qatar", "Czech Republic": "R√©publique tch√®que", "Romania": "Roumanie", "United Kingdom": "Royaume-Uni",
        "Russia": "Russie", "Rwanda": "Rwanda", "Saint Kitts and Nevis": "Saint-Christophe-et-Ni√©v√®s", "Saint Lucia": "Sainte-Lucie",
        "San Marino": "Saint-Marin", "Saint Vincent and the Grenadines": "Saint-Vincent-et-les-Grenadines",
        "Solomon Islands": "Salomon", "El Salvador": "Salvador", "Samoa": "Samoa", "Sao Tome and Principe": "Sao Tom√©-et-Principe",
        "Senegal": "S√©n√©gal", "Serbia": "Serbie", "Seychelles": "Seychelles", "Sierra Leone": "Sierra Leone",
        "Singapore": "Singapour", "Slovakia": "Slovaquie", "Slovenia": "Slov√©nie", "Somalia": "Somalie", "Sudan": "Soudan",
        "South Sudan": "Soudan du Sud", "Sri Lanka": "Sri Lanka", "Sweden": "Su√®de", "Switzerland": "Suisse",
        "Suriname": "Suriname", "Syria": "Syrie", "Tajikistan": "Tadjikistan", "Tanzania": "Tanzanie", "Chad": "Tchad",
        "Thailand": "Tha√Ølande", "East Timor": "Timor oriental", "Togo": "Togo", "Tonga": "Tonga",
        "Trinidad and Tobago": "Trinit√©-et-Tobago", "Tunisia": "Tunisie", "Turkmenistan": "Turkm√©nistan", "Turkey": "Turquie",
        "Tuvalu": "Tuvalu", "Ukraine": "Ukraine", "Uruguay": "Uruguay", "Vanuatu": "Vanuatu", "Vatican": "Vatican",
        "Venezuela": "Venezuela", "Vietnam": "Vietnam", "Yemen": "Y√©men", "Zambia": "Zambie", "Zimbabwe": "Zimbabwe"
    };

    // Fonction pour convertir le code pays (ex: FR) en Emoji
    function getFlagEmoji(countryCode) {
        if (!countryCode || countryCode === "-99") return "üè¥"; // Drapeau noir par d√©faut si code invalide
        const codePoints = countryCode
            .toUpperCase()
            .split('')
            .map(char =>  127397 + char.charCodeAt(0));
        return String.fromCodePoint(...codePoints);
    }

    // Fonction centralis√©e pour mettre √† jour l'interface
    function updateHeaderInfo(name, iso) {
        // Traduction utilisant la liste fournie ou nom par d√©faut
        const displayName = translations[name] || name;
        countryName.innerText = displayName;

        // Mise √† jour de l'emoji drapeau
        flagEmoji.innerText = getFlagEmoji(iso);
    }

    fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(r => r.json())
    .then(data => {
        L.geoJson(data, {
            style: { fillColor: '#333', fillOpacity: 0.6, color: '#555', weight: 1 },
            onEachFeature: (feature, layer) => {
                
                // --- SURVOL (MOUSEOVER) ---
                layer.on('mouseover', function() {
                    if(hqLocked) return;
                    
                    this.setStyle({fillOpacity: 0.8, fillColor: '#555'});
                    
                    const props = feature.properties;
                    const name = props.ADMIN || props.name;
                    const iso = props.ISO_A2 || props.iso_a2;
                    updateHeaderInfo(name, iso);
                });

                // --- SORTIE (MOUSEOUT) ---
                layer.on('mouseout', function() {
                    if (this !== selectedLayer) {
                        this.setStyle({fillOpacity: 0.6, fillColor: '#333'});
                    }

                    if(hqLocked) return;

                    if (selectedLayer) {
                        const sProps = selectedLayer.feature.properties;
                        updateHeaderInfo(sProps.ADMIN || sProps.name, sProps.ISO_A2 || sProps.iso_a2);
                    } else {
                        countryName.innerText = "SCANNING GEOPOLITICS...";
                        flagEmoji.innerText = "üè¥"; // Drapeau noir au repos
                    }
                });

                // --- CLIC ---
                layer.on('click', (e) => {
                    const props = feature.properties;
                    const name = props.ADMIN || props.name;
                    const iso = props.ISO_A2 || props.iso_a2;
                    
                    updateHeaderInfo(name, iso);

                    if(!hqLocked) {
                        if(selectedLayer) selectedLayer.setStyle({fillColor:'#333', weight: 1});
                        selectedLayer = layer;
                        layer.setStyle({fillColor:'#555', weight: 2});
                        document.getElementById('action-zone').innerHTML = `<button onclick="lockHQ()" style="background:var(--blue); border:none; padding:10px 20px; font-weight:bold; color:black; cursor:pointer;">LOCK REGION</button>`;
                    }
                });
            }
        }).addTo(map);
    });

    window.lockHQ = function() {
        hqLocked = true;
        selectedLayer.setStyle({ fillColor: '#00d4ff', color: '#ffd700', weight: 3, fillOpacity: 1 });
        document.getElementById('side-menu').classList.add('active');
        document.getElementById('toggle-btn').style.display = 'block';
        document.getElementById('toggle-btn').style.left = "320px";
        document.getElementById('hq-name').innerText = "HQ LOCATION: " + countryName.innerText;
        document.getElementById('action-zone').innerHTML = `<b style="color:var(--blue)">SECURED</b>`;
        map.fitBounds(selectedLayer.getBounds());
    };

    window.toggleMenu = function() {
        const menu = document.getElementById('side-menu');
        const btn = document.getElementById('toggle-btn');
        const isOpen = menu.classList.toggle('active');
        btn.innerText = isOpen ? "<" : ">";
        btn.style.left = isOpen ? "320px" : "0";
    };
</script>
</body>
</html>
